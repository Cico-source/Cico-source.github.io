<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Redirecting…</title>
  <script>
    (function() {
      const path = window.location.pathname;
      if (!path.startsWith("/join/")) {
        window.location.href = "/";
        return;
      }

      const code = path.split("/").pop();
      const httpsUrl = `https://cico-source.github.io/join/${code}`;
      const playStoreUrl = `https://play.google.com/store/apps/details?id=com.leonbela.belamultiplayerclient`;

      const urlObj = new URL(httpsUrl);
      const intentLink =
        `intent://${urlObj.host}${urlObj.pathname}#Intent;scheme=https;package=com.leonbela.belamultiplayerclient;S.browser_fallback_url=${encodeURIComponent(playStoreUrl)};end`;

      if (/android/i.test(navigator.userAgent)) {
        // On Android → try opening app via intent
        window.location.href = intentLink;

        setTimeout(() => {
          if (!document.hidden) {
            window.location.href = httpsUrl;
          }
        }, 800);
      } else {
        // On desktop → don't redirect infinitely, just show a message or Play Store
        document.body.innerHTML = `
          <h1>Open this link on your Android device</h1>
          <p>Or install the app from the <a href="${playStoreUrl}" target="_blank">Google Play Store</a>.</p>
          <p>Invite Code: <b>${code}</b></p>
        `;
      }
    })();
  </script>
</head>
<body>
  <h1>Redirecting…</h1>
</body>
</html>
